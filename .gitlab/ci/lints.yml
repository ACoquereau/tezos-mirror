check_opam_deps:
  extends: .build_template
  script:
    - ./scripts/opam-check.sh
  timeout: 10m # if it takes more than 10 minutes, then it'll just timeout after 1h

check_opam_lint:
  extends: .build_template
  script:
    - find . ! -path "./_opam/*" -name "*.opam" -exec opam lint {} +;

check_linting:
  extends: .build_template
  script:
    - make check-linting

check_precommit_hook:
  extends: .build_template
  script:
    - ./scripts/pre_commit/pre_commit.py --test-itself
    - cd tests_python
    - poetry run pylint ../scripts/pre_commit/pre_commit.py
    - poetry run pycodestyle ../scripts/pre_commit/pre_commit.py
    - poetry run mypy ../scripts/pre_commit/pre_commit.py

check_python_linting:
  extends: .build_template
  script:
    - make check-python-linting

check_python_types:
  extends: .build_template
  script:
    - make -C tests_python typecheck

check_scripts_b58_prefix:
  # Can be changed to a python image, but using the build docker image to keep
  # in sync with the python version used for the tests
  extends: .build_template
  before_script:
    - cd scripts/b58_prefix
    - poetry install
  script:
    - poetry run pylint b58_prefix.py --disable=missing-docstring --disable=invalid-name
    - poetry run pytest test_b58_prefix.py -v


